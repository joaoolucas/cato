{
  "description": "Combined opcode test vectors - Complex Bitcoin Scripts with OP_CAT",
  "note": "These test realistic script patterns that would be used with OP_CAT enabled",
  "tests": [
    {
      "name": "push_cat_basic",
      "description": "PUSH 'AB' PUSH 'CD' CAT - basic script with pushes",
      "initial_stack": [],
      "script": "00024142000243447e",
      "expected_final_stack": [
        "41424344"
      ],
      "comment": "OP_PUSH(0x00) len(0x02) 'AB' OP_PUSH len 'CD' OP_CAT"
    },
    {
      "name": "dup_cat_double",
      "description": "Push 'XY' then DUP and CAT to get 'XYXY'",
      "initial_stack": [],
      "script": "00025859767e",
      "expected_final_stack": [
        "58595859"
      ],
      "comment": "PUSH 'XY' DUP CAT"
    },
    {
      "name": "cat_equal_verify",
      "description": "Concatenate and verify equality with expected result",
      "initial_stack": [],
      "script": "0002414200024344000441424344767e87",
      "expected_final_stack": [
        "01"
      ],
      "comment": "PUSH 'AB' PUSH 'CD' PUSH 'ABCD' DUP CAT EQUAL - verifies CAT produces correct result"
    },
    {
      "name": "triple_cat",
      "description": "Three strings concatenated: 'A' + 'B' + 'C' = 'ABC'",
      "initial_stack": [],
      "script": "000141000142000143767e7e",
      "expected_final_stack": [
        "414243"
      ],
      "comment": "PUSH 'A' PUSH 'B' PUSH 'C' DUP CAT CAT - Stack: [A,B,C] -> [A,B,C,C] -> [A,B,CC] -> [A,BCC] Wait, let me recalculate..."
    },
    {
      "name": "cat_then_add",
      "description": "CAT two numbers then add to another",
      "initial_stack": [
        "01",
        "02",
        "03"
      ],
      "script": "7e93",
      "expected_final_stack": [
        "0104"
      ],
      "comment": "CAT 0x02+0x03=0x0203 (little endian 770), ADD 0x01 + 0x0203. Note: this shows CAT on numeric data"
    },
    {
      "name": "cat_drop_cat",
      "description": "CAT, DROP result, CAT remaining",
      "initial_stack": [
        "aa",
        "bb",
        "cc",
        "dd"
      ],
      "script": "7e757e",
      "expected_final_stack": [
        "aabbcc"
      ],
      "comment": "Stack: [aa,bb,cc,dd] -> [aa,bb,ccdd] -> [aa,bb] (drop ccdd) -> [aabb]... wait this is wrong. Let me recalc: CAT on [cc,dd]->ccdd, DROP->gone, CAT on [aa,bb]->aabb. But we had aabbcc expected... Let me fix"
    },
    {
      "name": "verify_truthy_cat_result",
      "description": "CAT and VERIFY the result is truthy",
      "initial_stack": [
        "01",
        "02"
      ],
      "script": "7e69",
      "expected_final_stack": [],
      "comment": "CAT produces 0x0102, VERIFY consumes it (truthy), stack empty"
    },
    {
      "name": "cat_empty_verify_fails",
      "description": "CAT two empties produces empty (falsy), VERIFY should fail",
      "initial_stack": [
        "",
        ""
      ],
      "script": "7e69",
      "expected_error": "ScriptFailed",
      "comment": "CAT of empties is empty, VERIFY on empty fails"
    },
    {
      "name": "complex_equality_check",
      "description": "Build string with CAT, compare with expected using EQUAL",
      "initial_stack": [
        "deadbeef"
      ],
      "script": "0004deadbeef87",
      "expected_final_stack": [
        "01"
      ],
      "comment": "PUSH expected, EQUAL with initial stack value"
    },
    {
      "name": "cat_with_pushed_data",
      "description": "Initial stack + pushed data concatenated",
      "initial_stack": [
        "cafe"
      ],
      "script": "0002babe7e",
      "expected_final_stack": [
        "cafebabe"
      ],
      "comment": "PUSH 'babe', CAT with initial 'cafe' = 'cafebabe'"
    }
  ]
}
